plugins {
    id 'java'
}

group = 'com.api'
version = '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    // REST API Testing
    implementation 'io.rest-assured:rest-assured:5.4.0'

    // TestNG for testing
    implementation 'org.testng:testng:7.12.0'

    // JSON parsing
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.17.0'

    // Logging
    implementation 'org.slf4j:slf4j-api:2.0.13'
    implementation 'ch.qos.logback:logback-classic:1.4.14'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

tasks.test {
    useTestNG() {
        suites 'src/test/resources/testng.xml' // your TestNG suite
    }

    // Ignore failure if no tests are discovered
    ignoreFailures = true

    // JVM options for reflective access (Java 21)
    jvmArgs '--add-opens', 'java.base/java.lang=ALL-UNNAMED'
    jvmArgs '--add-opens', 'java.base/java.util=ALL-UNNAMED'

    // Logging test results
    testLogging {
        events "passed", "skipped", "failed"
        exceptionFormat "full"
        showStandardStreams = true
    }

    // Reports
    reports {
        junitXml.required.set(true)
        html.required.set(true)
    }

    // Use Java toolchain
    javaLauncher = javaToolchains.launcherFor {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

// Ensure all Test tasks use Java 21
tasks.withType(Test).configureEach {
    javaLauncher = javaToolchains.launcherFor {
        languageVersion = JavaLanguageVersion.of(21)
    }
}
